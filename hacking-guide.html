<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Hacking into Fabric - Fabric Wiki</title>


    <!-- Custom HTML head -->
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff">

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->

</head>

<body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>
        <!-- hacky way to add a class to active sidebar items -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var chapterItems = document.querySelectorAll('.chapter li.chapter-item');

                chapterItems.forEach(function (item) {
                    if (item.querySelector('a.active')) {
                        // if it works, it works.
                        div = document.createElement('div');
                        item.insertBefore(div, item.firstChild);
                        item.classList.add('active');
                    }
                });
            });

        </script>
        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Let's Fabricate Some Stuff!</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.1.</strong> Introduction to Fabric</a></li><li class="chapter-item expanded "><a href="installation-guide.html"><strong aria-hidden="true">1.2.</strong> Installing Fabric</a></li><li class="chapter-item expanded "><a href="installing-stubs.html"><strong aria-hidden="true">1.3.</strong> Stubs Installation Guide</a></li><li class="chapter-item expanded "><a href="prepare.html"><strong aria-hidden="true">1.4.</strong> Prepare</a></li><li class="chapter-item expanded "><a href="first-widget.html"><strong aria-hidden="true">1.5.</strong> First Widget(s)</a></li><li class="chapter-item expanded "><a href="services.html"><strong aria-hidden="true">1.6.</strong> What is a "Service"</a></li><li class="chapter-item expanded "><a href="fabricators.html"><strong aria-hidden="true">1.7.</strong> What is a "Fabricator"</a></li><li class="chapter-item expanded "><a href="client-and-cli.html"><strong aria-hidden="true">1.8.</strong> CLI usage</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">1.9.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> API Reference (TBD)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Developer Guide</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacking-guide.html" class="active"><strong aria-hidden="true">3.1.</strong> Hacking into Fabric</a></li><li class="chapter-item expanded "><a href="development-environment.html"><strong aria-hidden="true">3.2.</strong> Setting up a development environment</a></li><li class="chapter-item expanded "><a href="code-style-guide.html"><strong aria-hidden="true">3.3.</strong> Code Style Guidelines</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function (e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor"
                            title="Toggle Table of Contents" aria-label="Toggle Table of Contents"
                            aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                            aria-label="Change theme" aria-haspopup="true" aria-expanded="false"
                            aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fabric Wiki</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Fabric-Development/fabric" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Fabric-Development/fabric-wiki/edit/main/src/hacking-guide.md" title="Edit this page" aria-label="Edit this page">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                            aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="hacking-into-fabric"><a class="header" href="#hacking-into-fabric">Hacking into Fabric</a></h1>
<p>Fabric is made to be a hackable package at its core. This guide will walk you through making your own modifications to Fabric's source!</p>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<blockquote>
<p>[!NOTE]
Please note that Fabric is built using GTK version 3; widgets from other versions are either incompatible or will require more effort to get to work.</p>
</blockquote>
<blockquote>
<p>[!TIP]
Having knowledge about how GTK and GObject works will greatly enhance your hacking ability while reducing issues along with the way; these are some useful resources to learn more about GTK and GObject.</p>
<ul>
<li><a href="https://python-gtk-3-tutorial.readthedocs.io/en/latest/">Sebastian's tutorial on PyGObject</a></li>
<li><a href="https://gnome.pages.gitlab.gnome.org/pygobject/">The official tutorial from PyGObject</a></li>
<li><a href="https://lazka.github.io/pgi-docs/">The docs the maintainer personally uses</a></li>
<li><a href="https://link.springer.com/book/10.1007/978-1-4842-4179-0">Foundations of PyGTK Development (book)</a></li>
</ul>
</blockquote>
<blockquote>
<p>[!TIP]
If the widget you're trying to implement was already implemented somewhere else (even if it was in another language) using GTK (version 3) and/or Cairo, porting it will be simple: you can just use the same drawing functions, since the Cairo bindings don't differ from language to another.</p>
</blockquote>
<h2 id="development-environment"><a class="header" href="#development-environment">Development Environment</a></h2>
<p>Before doing anything else, you should prepare your development environment; to do that, read <a href="development-environment.html">this page</a>.</p>
<h2 id="source-tree"><a class="header" href="#source-tree">Source Tree</a></h2>
<h3 id="widgets"><a class="header" href="#widgets">Widgets</a></h3>
<p>Fabric has a very special widget at its core: <code>Widget</code>(<code>fabric.widgets.widget</code>). Nearly every other Fabric widget inherits properties and methods from this widget. This makes it simple to make a modification that is reflected across all widgets.</p>
<h3 id="services-and-objects"><a class="header" href="#services-and-objects">Services and Objects</a></h3>
<p>Fabric has the <code>Service</code> base class (at <code>fabric.service</code>). New Fabric services should be inherited from this class. When doing this, make sure to replace the decorator <code>@property</code> with <code>@Property</code> (imported from <code>fabric.service</code>) to get notifiable properties in your service.</p>
<p>To create signals, you can change the variable <code>__gsignals__</code>. <code>__gsignals__</code>  takes a <code>SignalContainer</code> object (from <code>fabric.service</code>), and that signal container takes <code>Signal</code> objects as arguments. An example:</p>
<pre><code class="language-python">from fabric.service import *

class MyUsefulService(Service):
    __gsignals__ = SignalContainer(
        Signal("my-really-useful-signal", "run-first", None, (object,))
        # signal name, run flags, what does the call back return, the argument type of the callback
    )
    def __init__(self):
        self.emit("my-really-useful-signal", "this is my super useful argument passed to you, what a useful string")
</code></pre>
<p>For more details on services, head over to <a href="services.html">this wiki page</a>.</p>
<h2 id="writing-a-new-widget"><a class="header" href="#writing-a-new-widget">Writing a New Widget</a></h2>
<p>To start writing your own widget, you you should first check if GTK already includes that widget; after all, we don't want to reinvent the wheel. If GTK does implement the widget you're looking for, then the work will be much simpler. Even if it doesn't, you don't have to worry, since this page will also teach you how to write your own widget from scratch!</p>
<h3 id="my-widget-exists-within-gtk"><a class="header" href="#my-widget-exists-within-gtk">My Widget Exists Within GTK</a></h3>
<p>Do one of the following to get the widget:</p>
<ul>
<li>
<p>Just use it: Fabric is fully compatible with GTK widgets, so you can import the widget and use it however you need to. Note that this will not provide the new widget with all of Fabric's features (i.e setting the style within the construction), so if you require these see the option below.</p>
</li>
<li>
<p>Fabricate the widget: <em>fabricating</em> a widget means that you take a GTK widget and convert it into a Fabric widget; this will make it possible to use Fabric's features like special methods and properties.</p>
</li>
</ul>
<h4 id="fabricating-a-gtk-widget"><a class="header" href="#fabricating-a-gtk-widget">Fabricating a GTK Widget</a></h4>
<p>To start fabricating a widget, first check the type of the widget you want to fabricate. In general, there are two types of widgets: a regular widget and a container.</p>
<p>Normal widgets (AKA non-containers) are widgets that inherit properties and methods directly from the base <code>Widget</code> class and can't hold any child widgets (i.e. labels and images).</p>
<p>Containers are widgets that inherit properties and methods from the base <code>Container</code> class (which eventually inherits methods and properties from the base widget). These container widgets can hold one or multiple widgets as children (i.e. boxes and windows).</p>
<p>Next, you should locate where your widget class lives. For example, if your non-container widget is under the name <code>MyWidget</code> in GTK:</p>
<pre><code class="language-python">import gi # import the gi repository to get GTK from it later
gi.require_version("Gtk", "3.0") # graps the version 3 of GTK since this is what fabric uses
from gi.repository import Gtk # now we have GTK (version 3) imported

from fabric.widgets.widget import Widget # imports fabric's base widget 


class MyFabricatedWidget(Gtk.MyWidget, Widget): # creates a new class named "MyFabricatedWidget", this class inherits the desired GTK widget and fabric's base widget

    def __init__(self, **kwargs): # the initializer function, **kwargs (a dict) means whatever you pass as extra argument will be in that dict
        # you can set more arguments to this newly created class, this is useful if you want to make this widget able to do more during the initialization phase
        # you may add more logic here to handle the new arguments (if any)
        super().__init__(**kwargs) # initializes the new mixed class
</code></pre>
<p>Fabricating a container widget is the same process as fabricating a normal widget; just use the <code>Container</code> widget from Fabric instead of <code>Widget</code> when inheriting.</p>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<p>Oh, you ran into an issue. Don't panic! If your code does not work at all, <strong>read the error</strong>; most of the time, it provides a lot of information (i.e the call stack).</p>
<p>There are some specific errors that may be more difficult to debug, such as errors produced by GTK itself due to your function/method call. These errors, in most cases, only provide the assertion error (which <em>might</em> be handy to get a traceback). Here's how to debug these invisible <a href="https://en.wikipedia.org/wiki/Heisenbug">Heisenbugs</a>:</p>
<ul>
<li>
<p>Check your environment variables</p>
<ul>
<li>For example, I try running an X11 window under X11 but the environment variable <code>GDK_BACKEND</code> is set to <code>wayland</code> due to me forcing the editor to to set it this way and forgetting. This was the problem that caused my Wayland window to open as a normal window, not a layer. (Another possibility here was that I was using GNOME, which hasn't implemented the layer-shell protocol on Wayland and therefore makes it impossible to do anything to fix issues with it.)</li>
</ul>
</li>
<li>
<p>Use a debugger and breakpoints to identify the source of the problem</p>
<ul>
<li>For example, I decide to use a function that I know  exists in the source of the GI repository package I'm trying to use, but my code produces a segmentation fault every time I run it. (Later, while reading the docs, I figured out that this specific function was not exposed to the binding I was using.)</li>
</ul>
</li>
<li>
<p>Check your thread-safety</p>
<ul>
<li>For example, I make a new service and it works like a charm. After an unknown amount of time, though, the entire thing crashes. I later found out from a friend that I was updating the properties of an object defined in the main thread in a different thread, leading to a loss of <a href="https://en.wikipedia.org/wiki/Thread_safety">thread safety</a>. After discovering this issue, I found a function that did the same thing I needed to do (like <code>GLib.idle_add</code>) in a thread-safe way.</li>
</ul>
</li>
<li>
<p>Variable or method overwrites</p>
<ul>
<li>For example, I make a new class that inherits <code>Service</code>. I then write a new method: <code>connect</code>, but when I run the code I get an <code>ArgumentError</code> even though I pass everything necessary into the method. I then find out that the <code>Service</code> class already has a <code>connect</code> method that is used internally, so when I try to use <code>connect</code> in my new class I'm actually calling the method in the <code>Service</code> class. I fixed this issue by using a different class to inherit from, though you can also solve this type of issue by simply renaming the method.</li>
</ul>
</li>
</ul>
<h3 id="visual-bugs"><a class="header" href="#visual-bugs">Visual Bugs</a></h3>
<p>There's another kind of bug - the visual bugs. A visual bug means that the code works as expected, but there are graphical issues with rendering or drawing. A great tool to use for these issues with Fabric or GTK is the <a href="https://wiki.gnome.org/Projects/GTK/Inspector">GTK Inspector</a>.</p>
<p>To get the inspector window in Fabric, set the environment variable <code>GTK_DEBUG</code> to <code>interactive</code> before running your code.</p>
<hr />
<p>If you still can't find what's causing your code not to act as it should, you can always hop into Fabric's <a href="https://discord.gg/xKDnfGee">Discord server</a> and ask your question - we're happy to help!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <a rel="prev" href="faq.html" class="mobile-nav-chapters previous"
                            title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                            <i class="fa fa-angle-left"></i>
                        </a>

                        <a rel="next prefetch" href="development-environment.html" class="mobile-nav-chapters next"
                            title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                            <i class="fa fa-angle-right"></i>
                        </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                <a rel="prev" href="faq.html" class="nav-chapters previous" title="Previous chapter"
                    aria-label="Previous chapter" aria-keyshortcuts="Left">
                    <i class="fa fa-angle-left"></i>
                </a>

                <a rel="next prefetch" href="development-environment.html" class="nav-chapters next" title="Next chapter"
                    aria-label="Next chapter" aria-keyshortcuts="Right">
                    <i class="fa fa-angle-right"></i>
                </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
</body>

</html>