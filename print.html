<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Fabric Wiki</title>
    <meta name="robots" content="noindex">


    <!-- Custom HTML head -->
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff">

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->

</head>

<body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>
        <!-- hacky way to add a class to active sidebar items -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var chapterItems = document.querySelectorAll('.chapter li.chapter-item');

                chapterItems.forEach(function (item) {
                    if (item.querySelector('a.active')) {
                        // if it works, it works.
                        div = document.createElement('div');
                        item.insertBefore(div, item.firstChild);
                        item.classList.add('active');
                    }
                });
            });

        </script>
        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Let's Fabricate Some Stuff!</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.1.</strong> Introduction to Fabric</a></li><li class="chapter-item expanded "><a href="installation-guide.html"><strong aria-hidden="true">1.2.</strong> Installing Fabric</a></li><li class="chapter-item expanded "><a href="installing-stubs.html"><strong aria-hidden="true">1.3.</strong> Stubs Installation Guide</a></li><li class="chapter-item expanded "><a href="prepare.html"><strong aria-hidden="true">1.4.</strong> Prepare</a></li><li class="chapter-item expanded "><a href="first-widget.html"><strong aria-hidden="true">1.5.</strong> First Widget(s)</a></li><li class="chapter-item expanded "><a href="services.html"><strong aria-hidden="true">1.6.</strong> What is a "Service"</a></li><li class="chapter-item expanded "><a href="fabricators.html"><strong aria-hidden="true">1.7.</strong> What is a "Fabricator"</a></li><li class="chapter-item expanded "><a href="client-and-cli.html"><strong aria-hidden="true">1.8.</strong> CLI usage</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">1.9.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> API Reference (TBD)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Developer Guide</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="hacking-guide.html"><strong aria-hidden="true">3.1.</strong> Hacking into Fabric</a></li><li class="chapter-item expanded "><a href="development-environment.html"><strong aria-hidden="true">3.2.</strong> Setting up a development environment</a></li><li class="chapter-item expanded "><a href="code-style-guide.html"><strong aria-hidden="true">3.3.</strong> Code Style Guidelines</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function (e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor"
                            title="Toggle Table of Contents" aria-label="Toggle Table of Contents"
                            aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                            aria-label="Change theme" aria-haspopup="true" aria-expanded="false"
                            aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fabric Wiki</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Fabric-Development/fabric" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                            aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="what-is-fabric"><a class="header" href="#what-is-fabric">What is Fabric?</a></h1>
<p>Fabric is a widgets framework written and configured in <em>python</em>. Fabric main goals is to provide you a simple, easy and high-level way to declare and manage desktop widgets, it follows the signal controlled flow to make events handling much easier than ever, Fabric was heavily inspired from multiple other projects on the community like <a href="https://github.com/elkowar/eww">eww</a>, <a href="https://github.com/Aylur/ags">ags</a> and <a href="https://github.com/Alexays/Waybar">Waybar</a> to provide you a better experience in a familiar way</p>
<h1 id="why-fabric"><a class="header" href="#why-fabric">Why Fabric?</a></h1>
<p>Fabric might be your choice if you already know how to program in python or if you don't know how to configure the other alternatives, Fabric is type hinted in a proper way and it integrates nicely with code editors to give you the best typed, auto-completed and docstringed experience you can get, also Fabric gives you the ability to use other python library's since Fabric is a python library at the end</p>
<h1 id="fabric-and-gtk"><a class="header" href="#fabric-and-gtk">Fabric and GTK</a></h1>
<p>Fabric uses <a href="https://www.gtk.org/">GTK</a>, which's a widget and application development toolkit, Fabric uses the python bindings of GTK under the name <a href="https://wiki.gnome.org/action/show/Projects/PyGObject">PyGObject</a>
without GTK Fabric won't be a thing since it's one of the head dependencies of the project</p>
<h1 id="what-is-cairo"><a class="header" href="#what-is-cairo">What is Cairo?</a></h1>
<p><a href="https://www.cairographics.org/">Cairo</a> is a graphics and shape drawing library, GTK (version 3) uses Cairo to draw surfaces and widgets
GTK makes you able to draw custom surfaces and widgets using Cairo, see <a href="https://docs.gtk.org/gtk3/class.Bin">Gtk.Bin</a> and <a href="https://docs.gtk.org/gtk3/class.DrawingArea">Gtk.DrawingArea</a> for more info
also, Fabric uses Cairo to draw custom widgets that does not exist in GTK</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-guide"><a class="header" href="#installing-guide">Installing Guide</a></h1>
<p>it's really simple to get Fabric working, you just...</p>
<h2 id="1-install-python"><a class="header" href="#1-install-python">1. Install Python</a></h2>
<p>Fabric requires python version 3.11 or higher</p>
<p>for arch linux you do <code>pacman -S python</code> to get the latest version of python</p>
<h2 id="2-get-the-dependencies"><a class="header" href="#2-get-the-dependencies">2. Get The Dependencies</a></h2>
<p>this step does depend on your system, this command will work for arch linux to install the dependency's using <code>pacman</code></p>
<p><code>sudo pacman -S gtk3 cairo gtk-layer-shell libgirepository gobject-introspection gobject-introspection-runtime python python-pip python-gobject python-cairo python-loguru pkgconf</code></p>
<p><em>if you're not on Arch, you will have to figure out yourself what is the package names for your distribution</em></p>
<h2 id="3-install-fabric"><a class="header" href="#3-install-fabric">3. Install Fabric</a></h2>
<blockquote>
<p>[!TIP]
Fabric is available under the arch user repository with the name <code>python-fabric-git</code></p>
</blockquote>
<p>you can install Fabric globally using <code>pip install git+https://github.com/Fabric-Development/fabric.git</code> although we <strong>don't</strong> prefer this way because it might cause dependency issues, it's better to use a <a href="https://docs.python.org/3/library/venv">virtual environment</a>, to get Fabric in a virtual environment you'll have to do the following</p>
<p>make a new folder for your new project</p>
<pre><code class="language-bash">mkdir &lt;your-folder-name&gt;
</code></pre>
<p>change the current directory to this new folder</p>
<pre><code class="language-bash">cd &lt;your-folder-name&gt;
</code></pre>
<p>create a new virtual environment, this command will create a virtual environment with the name <code>venv</code></p>
<pre><code class="language-bash">python -m venv venv
</code></pre>
<p>source the newly created virtual environment</p>
<pre><code class="language-bash">source venv/bin/activate
</code></pre>
<p>now you can install packages, we can install Fabric now...</p>
<pre><code class="language-bash">pip install git+https://github.com/Fabric-Development/fabric.git
</code></pre>
<p>Fabric is now installed, you can run it and use it as long as you want, yet you will be missing auto-completions and type annotations in your code editor, to get it working head over to the <a href="installing-stubs.html">stubs installing guide</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-a-stub-package"><a class="header" href="#getting-a-stub-package">Getting a Stub Package</a></h1>
<p>to get code auto-completions and type-annotations in your code editor you can use one of the following tools/packages, each tool/package has it's own installation guide, follow the provided like to each method and install the one you like</p>
<h1 id="pygobject-stubs"><a class="header" href="#pygobject-stubs">PyGObject-Stubs</a></h1>
<p>PyGObject provides a <a href="https://github.com/pygobject/pygobject-stubs">python package</a> that gives you simple auto-completions, it's not made to be perfect nor near that, not all gi repositories are type-annotated or docstringed, it works if you're going to stick with the documentations of GTK and Fabric</p>
<h1 id="fakegir"><a class="header" href="#fakegir">FakeGir</a></h1>
<p><a href="https://github.com/strycore/fakegir">FakeGir</a> is a python script that generates a overrides file, it's not considered as stubs since you will have to configure your editor to use the path to the generated files instead of the actual code in the PyGObject package files</p>
<h1 id="gengir"><a class="header" href="#gengir">GenGir</a></h1>
<p><a href="https://github.com/santiagocezar/gengir">GenGir</a> is my favorite, it generates an actual stubs package and installs it for you whether in a virtual environment (if any) or your global python packages</p>
<h1 id="fabric-stubs"><a class="header" href="#fabric-stubs">Fabric Stubs</a></h1>
<p>there's an in-going process of writing a stubs package made to be used with Fabric based on a refined version of the stubs produced by <a href="https://github.com/santiagocezar/gengir">GenGir</a>, the package is still not public, this might get changed...</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prepare"><a class="header" href="#prepare">Prepare</a></h1>
<p>here's some stuff to prepare before hopping into Fabric...</p>
<h1 id="python"><a class="header" href="#python">Python</a></h1>
<p>Fabric is an advanced and complex python library. to take advantage of the full capabilities of Fabric, you should at least know the basics of python and have some understanding of the following concepts:</p>
<ul>
<li>Packages: like how to install python packages using <code>pip</code>, ability to use virtual environments</li>
<li>Variables: <code>hello = "world"</code></li>
<li>Functions: <code>def hello(): return "world"</code>, <code>hello = lambda: "world"</code></li>
<li>Conditionals: <code>if hello() == "world": ...</code></li>
<li>Loops: `for letter in hello(): print(letter)</li>
<li>Exception Handling: <code>try: print(not_defiend)</code>, <code>except: print("I FOUND THE UNFOUND")</code></li>
<li>Classes and Object-Oriented Programming: <code>class Supra(MarkII): ...</code></li>
</ul>
<hr />
<h2 id="python-learning-resources"><a class="header" href="#python-learning-resources">Python Learning Resource's</a></h2>
<ul>
<li><a href="https://wiki.python.org/moin/BeginnersGuide">Official Beginner's Guide</a></li>
<li><a href="https://docs.python.org/3/tutorial/">Official Tutorial</a></li>
<li><a href="https://automatetheboringstuff.com/">Automate the Boring Stuff, a free online book for complete beginners to programming</a></li>
<li><a href="https://learnxinyminutes.com/docs/python3/">Learn Python in y Minutes, complete cheat sheet for people who know programming already</a></li>
<li><a href="http://python.swaroopch.com/">Swaroopch's free Python book</a></li>
<li><a href="http://www.codeabbey.com/">Codeabbey, exercises for beginners</a></li>
</ul>
<hr />
<h1 id="gtk"><a class="header" href="#gtk">GTK</a></h1>
<p>hacking into Fabric will require you having more knowledge on python and some understanding of how GTK works, read the <a href="hacking-guide.html">hacking guide</a> for GTK learn resources</p>
<hr />
<h1 id="ready"><a class="header" href="#ready">Ready?</a></h1>
<p>assuming you already have Fabric installed by following this [[installation-guide]] guide, let's get started by <a href="first-widget.html">writing your first widget</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-your-first-widget"><a class="header" href="#creating-your-first-widget">Creating Your First Widget!</a></h1>
<p>now (assuming you have Fabric installed) we can write our first widget</p>
<h1 id="coding-the-basics"><a class="header" href="#coding-the-basics">Coding the Basics...</a></h1>
<p>here's an example of using Fabric to define a simple widget, you can create a new python file and add this code into it, don't worry, you don't have to understand anything since we'll walk you through every line</p>
<pre><code class="language-python">import fabric # importing the base pacakge
from fabric.widgets.window import Window # graps a Window object from fabric
from fabric.widgets.label import Label # gets a Label object

window = Window() # creates a new instance of the Window object and assign it to the `window` variable
label = Label("Hello, World") # creates a new Label instance and give it to the `label` variable, this label is set to "Hello, World"
window.add(label) # adds the label to the window
window.show_all() # to make the window and it's children appear up

fabric.start() # to start fabric
</code></pre>
<p>run the code using <code>python path/to/your/config.py</code></p>
<p>if everything goes fine, you should see a window that looks like this:
<img src="assets/first-widget-label.png" alt="" /></p>
<p>if you didn't already understood the code, it firstly imports Fabric and the used widgets to create this demo which's a <code>Window</code> and a <code>Label</code>, then it creates a new instance of each widget, for the label instance it get's created with the text "Hello, World", then it adds this label widget to the window and show's up that window (and all of it's children), lastly it starts Fabric so the window actually shows up</p>
<p>"now what?" you might be asking; "now, we do some <em><strong>REAL STUFF</strong></em>" i answer.</p>
<h1 id="level-1-boxes"><a class="header" href="#level-1-boxes">Level 1: Boxes</a></h1>
<p>in this level, we're going to start very simple by using some boxes and labels..</p>
<pre><code class="language-python">import fabric # importing the base pacakge
from fabric.widgets.window import Window # graps a Window object from fabric
from fabric.widgets.box import Box # gets a Box object
from fabric.widgets.label import Label # gets a Label object

box_1 = Box(
    orientation="v",
    children=Label("this is the first box")
)
box_2 = Box(
    orientation="h",
    spacing=28, # adds some spacing between the children
    children=[
        Label("this is the first element in this second box"),
        Label("btw, this box elements will get added horizontally")
    ]
)

box_1.add(box_2)

window = Window(
    children=box_1 # there's no need showing up this window using `show_all()` it'll show itself because the children is already passed
)

fabric.start()
</code></pre>
<p><em>result (notice the alignment of the labels)</em></p>
<p><img src="assets/first-widget-box.png" alt="" /></p>
<p>see this visual representation so you understand what's going on more clearly</p>
<p><img src="assets/first-widget-box-help.png" alt="" /></p>
<hr />
<p>now you probably got an idea about how box containers work with different orientations, we can follow up now</p>
<h1 id="level-2-buttons"><a class="header" href="#level-2-buttons">Level 2: Buttons</a></h1>
<p>without any further ado, let's see how the code will look like first...</p>
<pre><code class="language-python">import fabric
from fabric.widgets.box import Box
from fabric.widgets.label import Label
from fabric.widgets.button import Button
from fabric.widgets.window import Window

def create_button():
    button = Button(label="click me")
    button.connect("button-press-event", lambda *args: button.set_label("you clicked me"))
    return button

box = Box(
  orientation="v",
  children=[
    Label("fabric buttons demo"),
    Box(
      orientation="h",
      children=[
        create_button(),
        create_button(),
        create_button(),
        create_button(),
      ],
    ),
  ],
)

window = Window(
  children=box,
)

fabric.start()
</code></pre>
<p><em>result:</em></p>
<p><img src="assets/first-widget-button.png" alt="" /></p>
<p>this demo creates a window with a box inside of it, lets call it "first box", this first box orientation is set to be vertical, first child inside that box is a label with the text "fabric buttons demo", second child inside the first box is another box oriented horizontally, lets call it the "second box" , this second box has 4 buttons, each button is automatically generated using a function to handle creating buttons and connecting each buttons signal for us, since each widget can't be used more than one time as a child for a widget we made this function (<code>create_button</code>), it creates a new instance of a Fabric button and connects its <code>button-press-event</code> signal to a lambda function that basically changes the label of the same button to "you clicked me" when it gets clicked by the user</p>
<blockquote>
<p>[!TIP]
when you write a widget using Fabric, you're actually creating a genuine GTK widget under the hood
Fabric's purpose is to simplify and add an enjoyable touch to the widget-writing process
as we delve into widget creation, we might, for instance, nest a button within a box or embed text inside a button. this approach to defining widgets will feel remarkably familiar to frontend developers and those who have experience writing HTML</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="whats-a-services"><a class="header" href="#whats-a-services">What's a Services?</a></h1>
<p>services are some kind of "data servers", it's just a normal object that has properties and methods, it differs when it comes to properties though..</p>
<p>when one property of a service gets updated/changed , the service will emit a signal that users can connect to so they get notified with the changes</p>
<p>services follow a paradigm called the <a href="https://en.wikipedia.org/wiki/Observer_pattern">"observer pattern"</a>, thus it's a class that when it gets initialized it starts doing a <em>task</em> in the background while your code is executing, it shouldn't be blocking the main thread, users can connect to these objects so they get notified when a signal of that class object get emitted or if a property gets changed</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fabricator-what-is-that"><a class="header" href="#fabricator-what-is-that">Fabricator? What is That?</a></h1>
<p>fabricators are a special classes that gets grabs you info from <em>somewhere</em> , fabricators can poll data from external shell commands or internal python functions, it can also read streams of data, like a shell command that stays running by printing out data over the time to the standard output or <em>generator</em> functions that yield data</p>
<p>fabricators gives you a set of options, here's some of the options it gives you...</p>
<ul>
<li>the initial value this fabricator should be initialized with</li>
<li>where to poll the data, it can be a python function/generator or a shell command</li>
<li>the interval time of calling the passed command/function and poll data from it (in milliseconds)</li>
<li>whether you want data as a stream (for polling data from generators and stream shell commands)</li>
</ul>
<p>without any further ado, lets get some examples of using fabricators</p>
<p><strong>1. monitor player state:</strong>
this example utilizes a fabricator to read a stream from a external command (<code>playerctl -f status</code>) which will print the current media player state when it changes</p>
<pre><code class="language-python">import fabric
from fabric.utils.fabricator import Fabricate

# create a fabricator to continuously monitor player state
player_fabricator = Fabricate(poll_from="playerctl -F status", stream=True)

# define a function to handle state changes
def print_state_change(fabricator, value): # notice that the first argument is the fabricator itself
    print(f"player state changed: {value}")

# connect the fabricator to the "changed" signal and register the handler
player_fabricator.connect("changed", print_state_change)

# start the main loop
fabric.start()

# output (may vary)
# player state changed: playing
# player state changed: paused
# player state changed: playing
# ...
</code></pre>
<p><strong>2. display periodic updates:</strong>
in this example we use a fabricator to poll data from the shell command <code>date</code> every 500ms and print the output of it</p>
<pre><code class="language-python">import fabric
from fabric.utils.fabricator import Fabricate

# create a fabricator to periodically retrieve the date and time
date_fabricator = Fabricate(poll_from="date", interval=500)  # 500 milliseconds

# define a function to handle date updates
def print_date(fabricator, value):
    print(f"current date and time: {value.strip()}")

# connect the fabricator to the "changed" signal and register the handler
date_fabricator.connect("changed", print_date)

# start the main loop
fabric.start()

# output (may vary)
# current date and time: Mon Mar  4 02:50:10 AM EET 2024
# current date and time: Mon Mar  4 02:50:10 AM EET 2024
# current date and time: Mon Mar  4 02:50:11 AM EET 2024
# current date and time: Mon Mar  4 02:50:11 AM EET 2024
# current date and time: Mon Mar  4 02:50:12 AM EET 2024
# ...
</code></pre>
<p><strong>3. advanced polling with stopping condition:</strong>
in this example we fabricate a function instead of a shell command</p>
<pre><code class="language-python">import fabric
from fabric.utils.fabricator import Fabricate

# global variable to track the counter
number = 0

def generate_number(fabricator):
    global number
    number += 1
    return number

# create a fabricator to poll the number generation function
function_fabricator = Fabricate(poll_from=generate_number, interval=300)  # 300 milliseconds

def handle_number(fabricator, value):
    if value == 43:
        fabricator.stop_polling()
        print("fabricator stopped")
    else:
        print(f"generated number: {value}")

# connect the fabricator to the "changed" signal and register the handler
function_fabricator.connect("changed", handle_number)

# start the main loop
fabric.start()

# output
# generated number: 1
# generated number: 2
# generated number: 3
# ...
# generated number: 42
# fabricator stopped
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-cli-utility-and-client"><a class="header" href="#the-cli-utility-and-client">The CLI utility and client</a></h1>
<p>when you start fabric (using the <code>start</code> function) Fabric will start executing the GTK main thread and it will also start a DBus client at the same time, this client makes you able to execute code on the fly and get information about your configuration file (still not a lot of features (yet)), Fabric grabs all of your globals and locals so when you execute code using the client you get all of your variables, object or/and modules</p>
<p>the CLI utility is just a command line tool to use the client instead of dealing with DBus communications yourself</p>
<h2 id="usage"><a class="header" href="#usage">usage</a></h2>
<pre><code>$ python -m fabric --help
Usage: python -m fabric [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  execute  executes a python code within the running fabric instance
  info     gets info about the currently running fabric instance
</code></pre>
<h2 id="examples"><a class="header" href="#examples">examples</a></h2>
<pre><code>$ python -m fabric info -j
{'file': '/home/&lt;user&gt;/.config/fabric/bar.py'} # this is just an example, your output might differ, outupt is in json format because of the -j flag
</code></pre>
<pre><code>$ python -m fabric execute "bar.hide()" -j # executing python code
{'source': 'bar.hide()', 'exception': ''} # no errors
</code></pre>
<pre><code>$ python -m fabric execute "bar.this_method_does_not_exist()" -j # error should return
{'source': 'bar.this_method_does_not_exist()', 'exception': 'AttributeError("\'StatusBar\' object has no attribute \'this_method_does_not_exist\'")'} # there's an error, the exception got returned by fabric
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>[!TIP]
if you're using Fabric inside a virtual environment managed by something other than the <code>venv</code> module included by <code>python</code> and you're getting import errors (and all dependencies exist) , you can try using Fabric in a virtual environment generated by <code>python -m venv venv</code></p>
</blockquote>
<h3 id="audio-servicewidget-is-not-working"><a class="header" href="#audio-servicewidget-is-not-working">audio service/widget is not working</a></h3>
<p><code>libcvc</code> is missing, clone Fabric and install <code>libcvc</code> using the script included (<code>scripts/install_libcvc</code>)</p>
<h3 id="my-window-does-not-show-up"><a class="header" href="#my-window-does-not-show-up">my window does not show up</a></h3>
<p>this can be fixed by following these debugging steps</p>
<ul>
<li>check that you don't have any blocking code that runs before Fabric, (i.e doing web requests)</li>
<li>check if the window is showed using the <code>show_all</code> function</li>
</ul>
<hr />
<h1 id="wayland"><a class="header" href="#wayland">Wayland</a></h1>
<h3 id="my-window-size-goes-crazy-for-a-second-and-goes-back-to-normal-state"><a class="header" href="#my-window-size-goes-crazy-for-a-second-and-goes-back-to-normal-state">my window size goes crazy for a second and goes back to normal state</a></h3>
<p>this is a known issue when showing up an empty GTKLayerShell window on wl-roots compositors, a fix is to make sure not to show up any window as long as it's empty, you can set the <code>show_all</code> argument to <code>False</code> until you add a child to the window and later you can use the <code>.show_all()</code> method to show up the window</p>
<h3 id="my-window-show-up-as-a-normal-window-not-a-layer"><a class="header" href="#my-window-show-up-as-a-normal-window-not-a-layer">my window show up as a normal window not a layer</a></h3>
<p>this might happen if the <code>GDK_BACKEND</code> environment variable is set to <code>x11</code> or anything other than <code>wayland</code>, also this might happen if your compositor does not support the <code>layer-shell</code> protocol (e.g. GNOME is refusing to implement the protocol, <a href="https://gitlab.gnome.org/GNOME/gnome-shell/-/issues/1141#note_482766">source</a>)</p>
<p>if your compositor support the protocol, a fix for this issue will be by setting the <code>GDK_BACKEND</code> variable to <code>wayland</code> (e.g. <code>env GDK_BACKEND=wayland python path/to/fabric/config</code>)</p>
<h3 id="my-eventbox-isnt-eventboxing-properly"><a class="header" href="#my-eventbox-isnt-eventboxing-properly">my eventbox isn't eventboxing properly</a></h3>
<p>if you're on hyprland try downgrading to <code>0.28.0</code>, this is a known issue with hyprland layer surfaces
if not hyprland then it's better to provide more information via reporting this issue in our discord server or a github issue</p>
<h3 id="my-widget-aint-blurring-its-background-on-hyprland"><a class="header" href="#my-widget-aint-blurring-its-background-on-hyprland">my widget ain't blurring it's background on hyprland</a></h3>
<p>simple as adding these lines into your hyprland config</p>
<pre><code>layerrule = blur, fabric
layerrule = ignorezero, fabric
</code></pre>
<hr />
<h1 id="x11xorg"><a class="header" href="#x11xorg">X11/Xorg</a></h1>
<blockquote>
<p>[!WARNING]
Fabric's X11/Xorg backends are still experimental, issues might occur</p>
</blockquote>
<h3 id="cant-add-margin-to-my-window"><a class="header" href="#cant-add-margin-to-my-window">can't add margin to my window</a></h3>
<p>try setting the window type to <code>"popup"</code></p>
<h3 id="my-window-has-rounded-corners-that-i-didnt-set"><a class="header" href="#my-window-has-rounded-corners-that-i-didnt-set">my window has rounded corners that i didn't set</a></h3>
<p>checkout your compositor configuration, it might be setting a rounded corners for Fabric windows</p>
<h3 id="when-i-set-my-window-to-have-transparency-i-get-black-background-color"><a class="header" href="#when-i-set-my-window-to-have-transparency-i-get-black-background-color">when i set my window to have transparency i get black background color</a></h3>
<p>this might be caused due to you begin having no running compositor, checkout picom or compton</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hacking-into-fabric"><a class="header" href="#hacking-into-fabric">Hacking into Fabric!</a></h1>
<p>in the guts, Fabric is made to be a hackable package, this wiki page will walk you through doing your own modifications into Fabric's source!</p>
<h1 id="acknowledgements-and-notes"><a class="header" href="#acknowledgements-and-notes">Acknowledgements and Notes</a></h1>
<blockquote>
<p>[!NOTE]
please note that Fabric is built using GTK version 3, widgets from other versions are incompatible or will require more work to get it to work</p>
</blockquote>
<blockquote>
<p>[!TIP]
having knowledge about how GTK and GObject works will make you able to hack more without having issues along with the way, these are some useful resources to learn more about GTK and GObject</p>
<ul>
<li><a href="https://python-gtk-3-tutorial.readthedocs.io/en/latest/">Sebastian's tutorial on PyGObject</a></li>
<li><a href="https://gnome.pages.gitlab.gnome.org/pygobject/">The official tutorial from PyGObject</a></li>
<li><a href="https://lazka.github.io/pgi-docs/">The docs i personally use</a></li>
<li><a href="https://link.springer.com/book/10.1007/978-1-4842-4179-0">Foundations of PyGTK Development (book)</a></li>
</ul>
</blockquote>
<blockquote>
<p>[!TIP]
if the widget you're trying to implement was already implemented somewhere else (even if it was in whole another language) using GTK (version 3) and/or Cairo, porting it will be nothing hard, if that widget was drawn using Cairo, you can just use the same exact drawing functions since the Cairo bindings doesn't differ from language to another</p>
</blockquote>
<h1 id="development-environment"><a class="header" href="#development-environment">Development Environment</a></h1>
<p>before anything you should prepare your development environment, to do that read <a href="development-environment.html">this page</a></p>
<h1 id="source-tree"><a class="header" href="#source-tree">Source Tree</a></h1>
<h3 id="widgets"><a class="header" href="#widgets">Widgets</a></h3>
<p>Fabric has a very special widget, which's <code>Widget</code> (at <code>fabric.widgets.widget</code>), and that's because pretty much every other Fabric widget inherit properties and methods from this widget, this make's easier to make a modification that's intended to get reflected on all of the other widgets</p>
<h3 id="services-and-objects"><a class="header" href="#services-and-objects">Services and Objects</a></h3>
<p>Fabric has the <code>Service</code> base class (at <code>fabric.service</code>), inherit from this class if you're looking create a new Fabric service, also you should replace the decorator <code>@property</code> with the <code>@Property</code> decorator (imported from <code>fabric.service</code>) so you get notifiable properties in your service
to get signals you can change the variable <code>__gsignals__</code>, it takes a <code>SignalContainer</code> object (from <code>fabric.service</code>), that signal container takes <code>Signal</code> objects as an argument, here is an example...</p>
<pre><code class="language-python">from fabric.service import *

class MyUsefulService(Service):
    __gsignals__ = SignalContainer(
        Signal("my-really-useful-signal", "run-first", None, (object,))
        # signal name, run flags, what does the call back return, the argument type of the callback
    )
    def __init__(self):
        self.emit("my-really-useful-signal", "this is my super useful argument passed to you, what a useful string")
</code></pre>
<p>for more details on services, head over to <a href="services.html">this wiki page</a></p>
<h1 id="write-a-new-widget"><a class="header" href="#write-a-new-widget">Write a New Widget?</a></h1>
<p>to start writing your own widget you can firstly check if GTK do already support that widget, at the end, we don't want to reinvent the wheel, if GTK does implement the widget you're looking for, then the work will be much less harder, otherwise you don't have to worry since this page will also teach you how to write your own widget from scratch!</p>
<h1 id="my-widget-exists-within-gtk"><a class="header" href="#my-widget-exists-within-gtk">My Widget Exists Within GTK</a></h1>
<p>you can do one of the following to get the widget...</p>
<ul>
<li>
<p>just use it: Fabric is fully compatible with GTK widgets so you can import the widget and use it as you want, note that this will not provide the new widget with all of Fabric's features (i.e setting the style within the construction), to get these features skip to the next point</p>
</li>
<li>
<p>fabricate the widget: <em>fabricating</em> a widget means that you take a GTK widget and convert it into a Fabric widget, this will make you able to use all Fabric features like special methods and properties</p>
</li>
</ul>
<h1 id="fabricating-a-gtk-widget"><a class="header" href="#fabricating-a-gtk-widget">Fabricating a GTK Widget</a></h1>
<p>to start off you first have to check the type of the widget you want to fabricate, there's two types in general, a normal widget, and a container</p>
<p>normal widgets (AKA non-containers) are widgets that inherit properties and methods from the base widget (<code>Widget</code>) and can't hold any widgets inside of it (i.e, labels and images)</p>
<p>containers are normal widgets that inherit properties and methods from the base container class (<code>Container</code>) which also inherit methods and properties from the base widget (<code>Widget</code>), these container widgets can hold one or multiple widgets as a children (i.e boxes and windows)</p>
<p>to fabricate a non-containing widget you first have to locate where your widget class lives, lets say your widget lives under the name <code>MyWidget</code> in GTK</p>
<pre><code class="language-python">import gi # import the gi repository to get GTK from it later
gi.require_version("Gtk", "3.0") # graps the version 3 of GTK since this is what fabric uses
from gi.repository import Gtk # now we have GTK (version 3) imported

from fabric.widgets.widget import Widget # imports fabric's base widget 


class MyFabricatedWidget(Gtk.MyWidget, Widget): # creates a new class named "MyFabricatedWidget", this class inherits the desired GTK widget and fabric's base widget
    def __init__(self, **kwargs): # the initializer function, kwargs (a dict) means whatever you pass as extra argument will be in that dict
        # you can set more arguments to this newly created class, this is useful if you want to make this widget able to do more stuff within the initialization phase
        # more logic to handle the new arguments (if any)
        super().__init__(**kwargs) # initializes the new mixed class
</code></pre>
<p><em>fabricating a container widget will be same as fabricating a normal widget, you just use the <code>Container</code> widget from Fabric instead of <code>Widget</code></em></p>
<h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>now you got into issues, no panic (ok?), if your code does not work at all, <em>read the error</em>, most of the times it provides a got set of information (i.e the call stack)</p>
<p>there is some specific errors that might be hard to debug, for examples errors produced by GTK itself due to your function/method call, these errors mostly are useless but the can sometimes be helpful, it only provides the assertion error for the most cases which might be handy to get a traceback of what's causing this issue to happen, also sometimes you get absolutely nothing useful out from the error, this is how to debug these invisible <a href="https://en.wikipedia.org/wiki/Heisenbug">Heisenbugs</a></p>
<ul>
<li>check your environment variables
e.g. i tried running an X11 window under X11 but the environment variable <code>GDK_BACKEND</code> was set to <code>wayland</code> due to me forcing the editor to to set it this way and i was forgotten that it was an issue from the environment variables</li>
</ul>
<p>e.g. my window works and all but me begin under wayland the window should open as a layer not a normal window, later i checked on my environment variables and found the <code>GDK_BACKEDN</code> set to <code>x11</code>
another possibility that i was using GNOME and because GNOME begin GNOME they haven't implemented the layer-shell protocol on wayland, which makes me empty handed to do anything about this. i &lt;3 GNOME!</p>
<ul>
<li>
<p>use a debugger and breakdowns to determinate which call causes the issue
e.g. i decided to call a function that i know it exists in the source of the GI repository package i'm trying to use, my code segfaults everytime i run it, later while reading the docs i knew that this specific function is not exposed to the binding i'm using anyways the recommend me another way of doing the same <em>thing</em> the function i'm trying to use does</p>
</li>
<li>
<p>check your threads stack
e.g. i made a new service, it works like a charm, but after unknown amount of time the entire thing crash, i later found out from a friend that i should update the properties of a object declared in the main thread should be done in the main thread, he pointed me to the part i use a thread so i checked on there to found that i indeed do call a function defined in the main thread and pass to it an object defined in my thread which led to my code begin <a href="https://en.wikipedia.org/wiki/Thread_safety">thread safe</a>, after looking for a solution i found out that i can use something like <code>GLib.idle_add</code> to call a function with my objects in a thread safe way, everything works now as expected</p>
</li>
<li>
<p>variable overwrites
e.g. i made a class that inherits the service class, i made a new method in my new class called <code>connect</code>, i wrote the logic of it and everything is fine, but when i run the code i get an argument error, i do pass everything intended to to passed to this function, ITS WRITTEN TO HANDLE THIS, but i found out that the metaclass (which's the service class) already do have a method with the name <code>connect</code> and also the metaclass uses this function internally, so when the service class calls the method <code>connect</code> i receive the call in my inherited class because i've already overwrote the original method, at the end i was able to come across this by just yeeting the service class since i NEED my method name to be <code>connect</code></p>
</li>
</ul>
<p>these was all the possibilities i was able to think of for generally code issues and hidden bugs</p>
<hr />
<p>now, there's another kind of bugs, which's the visual bugs, means that actually the code works as expected but there's some unexpected drawing issues, at this point you can checkout the <a href="https://wiki.gnome.org/Projects/GTK/Inspector">GTK Inspector</a>, it's really useful for this kind of issues</p>
<p>to get the inspector window you can set the environment variable <code>GTK_DEBUG</code> to <code>interactive</code> before running your code</p>
<hr />
<p>still can't find what's causing your code not to act as it should to?, you can always hop into Fabric's discord server and ask on whatever you want and we would be more than happy helping you!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development-environment-1"><a class="header" href="#development-environment-1">Development Environment</a></h1>
<p>this page will walk you through setting up your hacking environment</p>
<h1 id="setup-the-source"><a class="header" href="#setup-the-source">Setup The Source</a></h1>
<p>to start developing it's better to grab the latest commit for Fabric so you're up-to-date
for that you use</p>
<pre><code class="language-bash">git clone https://github.com/Fabric-Development/fabric
</code></pre>
<blockquote>
<p>[!NOTE]
not that when you clone the source it will be located at the same current working directory</p>
</blockquote>
<p>you can now change the current directory into the newly cloned source</p>
<pre><code class="language-bash">cd fabric
</code></pre>
<h1 id="start-hacking"><a class="header" href="#start-hacking">Start Hacking</a></h1>
<p>now you can continue inside using your code editor, this step is optional but using a IDE will make your life easier</p>
<p><em>for this example we use VSCode as the code editor</em></p>
<pre><code>code .
</code></pre>
<p><strong>now we can start initializing the python environment</strong></p>
<p>first we will create a new python venv and source it</p>
<pre><code class="language-bash">python -m venv venv
</code></pre>
<pre><code class="language-bash">source venv/bin/activate
</code></pre>
<p><em>now we have a separated environment from system wide</em></p>
<p>next we install the current Fabric source in place as a package</p>
<pre><code class="language-bash">pip install -r requirements.txt
pip install -e .
</code></pre>
<p>everything is now ready, you can continue the hacking from <a href="hacking-guide.html">this page</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="style-guide"><a class="header" href="#style-guide">Style Guide</a></h1>
<blockquote>
<p>first of all. we <strong>really</strong> appreciate your attention to contribute into our project!</p>
</blockquote>
<p>this is the style guide of our project, here we'll walk you trough how can you write silk looking code that will embed nicely into our code-base</p>
<p><strong>here is the list of code style guides</strong></p>
<h2 id="code-properties-and-formatting"><a class="header" href="#code-properties-and-formatting">Code Properties and Formatting</a></h2>
<p>The code should be formatted using <a href="https://github.com/astral-sh/ruff">the ruff python formatter</a>.
Indentation must be 4 <strong>spaces</strong>, Please do not use tabs or less/more than 4 <strong>spaces</strong></p>
<h2 id="defining-and-naming"><a class="header" href="#defining-and-naming">Defining and Naming</a></h2>
<p>We employ different naming conventions based on use cases:</p>
<ul>
<li><code>snake_case</code>: for function or variable definitions.</li>
<li><code>SCREAMING_SNAKE_CASE</code>: reserved for constants.</li>
<li><code>PascalCase</code>: employed for class definitions.</li>
<li><code>kebab-case</code> (<code>lower-case-only</code>): utilized for defining a GObject signal/property.</li>
</ul>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<p>Follow <a href="https://peps.python.org/pep-0008/">PEP-8's</a> guidelines when adding comments. in a nutshell, comments should look:</p>
<pre><code class="language-python"># Like this.

##not like this..##
#nor like this.
#--/ nor whatever else /--#
</code></pre>
<h2 id="logging"><a class="header" href="#logging">Logging</a></h2>
<p>Logging should be executed using <a href="https://github.com/Delgan/loguru">loguru</a>. adhere to these rules:</p>
<ul>
<li>be concise; avoid verbosity.</li>
<li>refrain from committing files with the log level <code>debug</code>.</li>
<li>reserve the log level <code>error</code> for critical cases, such as severe component failures or dependencies crucial to the entire program.</li>
<li>avoid unnecessary <code>info</code> statements in low-level classes/modules, unless it's a service subclass.</li>
</ul>
<p><em>If uncertain about where to log, feel free to inquire in the pull request, or someone may suggest a suitable location.</em></p>
<h1 id="condition-statements"><a class="header" href="#condition-statements">Condition Statements</a></h1>
<p>In our code-base we use inline if/else statements if this condition will change the fate of a single object, for example</p>
<pre><code class="language-python">x = "the x object" if unexcpected_feature is not True else "the x man"
</code></pre>
<p>and we use normal if statements if that condition will execute a block of code instead of a one line object, here is an example</p>
<pre><code class="language-python">if unexcpected_feature is True:
    x = "the unknown guy"
    y = "idk"
    z = 4002
</code></pre>
<p>this choice will be much better than doing</p>
<pre><code class="language-python">x = "the unknown guy" if unexcpected_feature is True else None
y = "forgor" if unexcpected_feature is True else None
z = 4002 if unexcpected_feature is True else None
</code></pre>
<h1 id="logging-the-changes"><a class="header" href="#logging-the-changes">Logging The Changes</a></h1>
<p>When you're finally done working on your commits and you see everything is ready you just add info of the commit(s) you made to the <code>CHANGELOG.md</code> file describing the changes made in a simple language and a small amount of characters, for example...</p>
<pre><code>-- Format --

&lt;Change-Number&gt;. &lt;#Pull-Request-Number&gt; &lt;Commit-Message&gt;

-- Examples --

1. &lt;#Pull-Request-Number&gt; feat: something awesome!

2. &lt;#Pull-Request-Number&gt; feat: new method to do magic!

3. &lt;#Pull-Request-Number&gt; fix: fabricated, this fixes/closes &lt;issue number if exists&gt;!

4. refactor: i dunno how to fabricate XD

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
            window.addEventListener('load', function () {
                window.setTimeout(window.print, 100);
            });
        </script>

    </div>
</body>

</html>